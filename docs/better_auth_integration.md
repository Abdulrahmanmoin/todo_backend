# Better Auth Integration Guide

This document explains how Better Auth is integrated with the FastAPI backend for the Todo application.

## Overview

Better Auth is a comprehensive authentication framework that is primarily used in the frontend (Next.js) application. The FastAPI backend is configured to work alongside Better Auth by:

1. Maintaining compatibility with Better Auth's token format
2. Providing API endpoints that follow Better Auth patterns
3. Using JWT tokens that can be validated by both systems

## Architecture

```
Frontend (Next.js)          Backend (FastAPI)          Database (PostgreSQL)
     |                            |                          |
     |---- Better Auth ------>    |                          |
     |     (handles auth)         |                          |
     |                            |                          |
     |---- API calls --------->    |---- Validates tokens -> |
     |                            |     using JWT            |
     |                            |                          |
     |<--- API responses ----     |<--- Returns user data -- |
```

## Endpoints

### Registration: `POST /auth/register`
- Creates new users in the database
- Validates email format and password strength
- Checks for duplicate email/username
- Returns user data without sensitive information

### Login: `POST /auth/login`
- Authenticates users with email/password
- Creates JWT tokens compatible with Better Auth format
- Returns access token and user information

### Get Current User: `GET /auth/me`
- Validates JWT token from Authorization header
- Returns authenticated user data
- Uses the same token validation as Better Auth

### Logout: `POST /auth/logout`
- Placeholder endpoint for logout functionality
- In a full Better Auth integration, this would invalidate Better Auth sessions

## Token Format

The JWT tokens generated by the FastAPI backend follow the same structure as Better Auth for compatibility:

```json
{
  "user_id": "uuid-string",
  "exp": 1234567890,
  "iat": 1234567890
}
```

## Security Best Practices

1. **Password Security**: All passwords are hashed using bcrypt before storage
2. **Input Validation**: Email format and password strength are validated
3. **Rate Limiting**: Should be implemented at the application level
4. **Token Security**: JWT tokens have configurable expiration times
5. **Error Handling**: Proper error responses without exposing sensitive information

## Environment Variables

The following environment variables are required for proper operation:

- `SECRET_KEY`: Secret key for JWT signing (should be 32+ characters)
- `ALGORITHM`: JWT algorithm (default: HS256)
- `ACCESS_TOKEN_EXPIRE_MINUTES`: Token expiration time (default: 10080 minutes/7 days)
- `DATABASE_URL`: PostgreSQL database connection string

## Integration Notes

- The user registration endpoint is fully compatible with Better Auth patterns
- The login endpoint creates tokens that can be used by both systems
- The `/me` endpoint validates tokens and returns user information
- Database models are compatible with Better Auth's expected user schema

## Future Enhancements

1. Implement full session invalidation for logout
2. Add 2FA support using Better Auth's 2FA plugin
3. Implement email verification flows
4. Add social login providers
5. Implement refresh token functionality